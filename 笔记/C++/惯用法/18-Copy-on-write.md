---
title: "[C++ Idioms] 18. [-] Copy on write"
date: 2017-07-30 19:12:22
categories: C++ Idioms
tags:
    - C++
    - Idioms
---
写时复制。<!--more-->  
复制构造时保存数据指针，等到写入时再复制。很多地方会用到，比如fork、内存映射（可以设置写时复制标识）等。  
_据说stl的string里有实现这个，但是找了一遍没见到，调试时也没发现有写时复制的迹象，也跟踪了数据指针，发现都是新复制的，是不是漏看了什么……_  
关于捕获写操作，只要重写operator `->`、`.`就可以，写两个版本，一个返回const，一个没const，这样在写入时编译器会选择没const的版本，这样就可以捕获到写操作，数组的重写`[]`就可以了。  
