---
title: "[C++ Idioms] 61. Pointer To Implementation（Pimpl）"
date: 2017-08-03 17:33:05
categories: [学习笔记,C++ Idioms]
tags:
    - C++
    - Idioms


---
将类的实现与其使用者隔离。<!--more-->隔离后的类在独自修改时，不会使其它使用到它的类被重新编译（编译防火墙），还可以对类的使用者隐藏实现。  
这个惯用法有很多文章都会讨论（也给它起了很多名字），但实际看一些代码，其实用得不多（可能是因为要实现调用转发要重新编写一次接口太累了，至少我这样认为）。在速度上是会降一些，但是在可接受范围之内。  

大体上结构是这样的：
```cpp
// 只传达意思，省去了会混淆的内容
class Impl
{
public:
	void Do()
	{
		cout << "DO" << endl;
	}
};

class PImpl
{
public:
	PImpl()
	{
		// 可以直接new，或者用对象池
		impl_ = new Impl();
	}
	~PImpl()
	{
		// 做一些回收工作，这里略
	}
	// 实现接口，实现转发调用，但是如果有很多函数的话就很累了（可以用写脚本生成代码的方式生成）
	void Do()
	{
		impl_->Do();
	}
private:
	Impl* impl_;
};

```
这样在Impl变化的时候，由于其它类型引用的是PImpl，所以不会使其它类被重新编译，在这个类被普遍使用的时候且这个项目很大时可以节约很多编译时间。